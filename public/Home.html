<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Good Games</title>
  <link rel="stylesheet" href="style.css" />
</head>

<body>
  <div class="container">

    <!-- Title -->
    <p class="title">
      <span class="bigLetter">G</span>ood
      <span class="bigLetter">G</span>ame
      <span class="bigLetter">S</span>
    </p>

    <!-- Auth Buttons -->
    <div class="auth-buttons">
      <a href="signIn.html"> <button class="auth-button" id="signInButton">Sign In</button> </a>
      <a href="signUp.html"> <button class="auth-button" id="signUpButton">Sign Up</button> </a>
      <button class="auth-button" id="myListButton" style="display:none; width: 150px; ">My List </button>
    </div>

    <div class="sideMenu" id="sideMenu">
      <div class="hamburger" id="hamburger">
        <div></div>
        <div></div>
        <div></div>
      </div>
      <div class="sideMenuPanel" id="sideMenuPanel">
        <div class="hamburger" id="sideMenuHamburger">
          <div></div>
          <div></div>
          <div></div>
        </div>
        <div class="sideMenuItems">
          <div class="sideMenuItem">
            <a href="Home.html" class="menuItem" id="homeLink">Home</a>
          </div>
          <div class="sideMenuItem">
            <a href="myList.html" class="menuItem" id="myListLink">My List</a>
          </div>
          <div class="sideMenuItem">
            <a href="search.html" class="menuItem" id="myListLink">Search</a>
          </div>
          <div class="sideMenuItem">
            <a href="myList.html" class="menuItem" id="myListLink">Placeholder</a>
          </div>
          <div class="sideMenuItem">
            <a href="about.html" class="menuItem" id="aboutLink">About</a>
          </div>
        </div>
      </div>

    </div>


    <!-- Search -->

    <h3 class="searchTitle">Search for a Game!</h3>
    <div class="search-controls">
      <input type="text" class="searchBar" id="searchBar" placeholder="Enter a game name..." />
      <button class="searchButton" id="searchButton">Search</button>
    </div>

    <div class="results" id="results">

    </div>

    <!-- Carousel (placeholder image for now) -->
    <div class="carousel">
      <p>Carosel here</p>
    </div>
  </div>
</body>

<script>

  document.getElementById('hamburger').addEventListener('click', function () {
    const panel = document.getElementById('sideMenuPanel');
    panel.classList.toggle('open');
  });

  document.getElementById('sideMenuHamburger').addEventListener('click', function () {
    const panel = document.getElementById('sideMenuPanel');
    panel.classList.remove('open');
  });

  function isTokenValid(token) {
    if (!token) return false;

    try {
      const payload = JSON.parse(atob(token.split('.')[1]));
      return payload.exp * 1000 > Date.now();
    }
    catch (e) {
      return false;
    }
  }

  window.addEventListener('DOMContentLoaded', () => {
    const token = localStorage.getItem('token');
    const myListButton = document.getElementById('myListButton');
    const signInButton = document.getElementById('signInButton');
    const signUpButton = document.getElementById('signUpButton');
    console.log('Token:', token);
    if (isTokenValid(token)) {
      myListButton.style.display = 'block';
      signInButton.style.display = 'none';
      signUpButton.style.display = 'none';
    }
    else {
      myListButton.style.display = 'none';
      signInButton.style.display = 'block';
      signUpButton.style.display = 'block';
    }
  })

  document.getElementById('searchBar').addEventListener('keydown', function (e) {
    if (e.key === 'Enter') {
      document.getElementById('searchButton').click();
    }
  })

  document.getElementById('searchButton').addEventListener('click', async () => {
    const query = document.getElementById('searchBar').value;
    const res = await fetch(`/games?search=${encodeURIComponent(query)}`);
    const data = await res.json();
    console.log(data);

    const resultsDiv = document.getElementById('results');
    resultsDiv.innerHTML = '';

    if (!data.results || data.results.length === 0) {
      resultsDiv.innerHTML = '<p>No results found</p>';
      return;
    }

    data.results.forEach(game => {
      const itemDiv = document.createElement('div');
      itemDiv.className = 'result-item';

      const img = document.createElement('img');
      img.src = game.background_image || 'https://via.placeholder.com/100';
      img.alt = game.name;
      img.style.maxWidth = '100px';
      img.style.maxHeight = '100px';

      const textDiv = document.createElement('div');
      const p = document.createElement('p');
      p.textContent = `${game.name} (${game.released}) - Rating: ${game.rating}`;
      textDiv.appendChild(p);

      const plus = document.createElement('button');
      plus.textContent = '+';

      itemDiv.appendChild(img);
      itemDiv.appendChild(textDiv);
      itemDiv.appendChild(plus);
      resultsDiv.appendChild(itemDiv);
    });
  });

</script>

</html>